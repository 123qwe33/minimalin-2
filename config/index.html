<!DOCTYPE html>
<html>
  <head>
    <title>Minimalin Configuration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
    <script type='text/javascript' src='js/ractive.min.js'></script>
    <script type='text/javascript' src='js/ractive-transitions-slide.js'></script>
    <script type='text/javascript' src='//cdn.jsdelivr.net/ractive.load/latest/ractive-load.min.js'></script>
    <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
    <link rel="prefetch" href="./fonts/Nupe.ttf">
    <link rel="prefetch" href="./template/ItemColor.html">
    <link rel="prefetch" href="./template/ToggleWithItemColor.html">
    <link rel="prefetch" href="./template/Tabs.html">
    <link rel="prefetch" href="./template/Input.html">
    <link rel="prefetch" href="./template/Toggle.html">
  </head>
  <body>
    <script type='text/javascript'>
     if (typeof Object.assign != 'function') {
       (function () {
         Object.assign = function (target) {
           'use strict';
           // We must check against these specific cases.
           if (target === undefined || target === null) {
             throw new TypeError('Cannot convert undefined or null to object');
           }

           var output = Object(target);
           for (var index = 1; index < arguments.length; index++) {
             var source = arguments[index];
             if (source !== undefined && source !== null) {
               for (var nextKey in source) {
                 if (source.hasOwnProperty(nextKey)) {
                   output[nextKey] = source[nextKey];
                 }
               }
             }
           }
           return output;
         };
       })();
     }
     Ractive.DEBUG = false;
     var query = function(variable, defaultVariable) {
       var query = location.search.substring(1);
       var vars = query.split('&');
       for (var i = 0; i < vars.length; i++) {
         var pair = vars[i].split('=');
         if (pair[0] === variable) {
           return decodeURIComponent(pair[1]);
         }
       }
       return defaultVariable || null;
     };

     var queryJSON = function(variable, defaultVariable) {
       var value = query(variable, defaultVariable);
       try{
         return JSON.parse(value);
       }catch(e){
         return defaultVariable;
       }
     }
     var config = queryJSON('config', {});
     var bw = config.platform == 'aplite' || config.platform == 'diorite';
     var defaultsThemes;
     if(bw){
       defaultsThemes = [
         {
           name: 'Dark',
           minute_hand_color: 0xFFFFFF,
           hour_hand_color:  0xFFFFFF,
           background_color: 0x000000,
           time_color: 0xFFFFFF,
           info_color: 0xFFFFF
         },
         {
           name: 'Light',
           minute_hand_color: 0x000000,
           hour_hand_color:  0x000000,
           background_color: 0xFFFFFF,
           time_color: 0x000000,
           info_color: 0x00000
         }
       ];
     }else{
       defaultsThemes = [
         {
           name: 'Default',
           minute_hand_color: 0xFFFFFF,
           hour_hand_color:  0xFF0000,
           background_color: 0x000000,
           time_color: 0xAAAAAA,
           info_color: 0x555555
         },
         {
           name: 'Sky',
           minute_hand_color: 0xFFFFFF,
           hour_hand_color:  0x00AAFF,
           background_color: 0x000000,
           time_color: 0xAAAAAA,
           info_color: 0x555555
         },
         {
           name: 'Solarized',
           minute_hand_color: 0x000000,
           hour_hand_color:  0x005555,
           background_color: 0xffffff,
           time_color: 0xaaaaaa,
           info_color: 0x555555
         },
         {
           name: 'Hipster',
           background_color: 0xaaaaaa,
           hour_hand_color: 0xf56c38,
           minute_hand_color: 0xffffff,
           time_color: 0xaa5500,
           info_color: 0x555555
         }
       ];
     }
     var defaults = {
       platform: 'basalt',
       date_displayed:  true,
       health_enabled: false,
       bluetooth_icon: 1,
       battery_displayed_at: -1,
       rainbow_mode: false,
       temperature_unit: 0,
       refresh_rate: 20,
       weather_enabled: true,
       location: '',
       vibrate_on_the_hour: false,
       military_time: false,
       selected_theme: 0,
       themes: defaultsThemes
     }
     var data = JSON.parse(JSON.stringify(defaults));
     Object.assign(data, config);
     var currentTheme = data.themes[data.selected_theme];
     if(data.selected_theme !== false){
       Object.assign(data, currentTheme);
     }
     data.defaults = defaults;
     Ractive.load('template/ConfigView.html').then(function(ConfigView) {
       new ConfigView({
         el: 'body',
         data: data
       });
     });
    </script>
  </body>
</html>
